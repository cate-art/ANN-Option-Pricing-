#clan the workspace
rm(list = ls())
#packages
library(tidyverse)
library(fOptions)
library(ggplot2)
library(roll)
library(lubridate)
library(imputeTS)
library(arules)
#Loading the excel file
index_series <- read.csv("../data/index_series.csv")
option_characteristics <- read.csv("../data/option_characteristics.csv")
option_series <- read.csv ("../data/option_series.csv")
treasury_bill <- read.csv ("../data/DTB3.csv")
#merge option_series & option_characteristics
option = option_series %>% left_join(option_characteristics)
#merge option & index
option_file = option %>% left_join(index_series)
#trasform format in date format for both exdate and date
option_file = option_file %>% mutate(exdate=as.Date(exdate))
option_file = option_file %>% mutate(date=as.Date(date))
#trasform format in date format for both exdate and date
treasury_bill = treasury_bill %>% mutate(DATE=as.Date(DATE))
#time to maturity
option_file$maturity <- option_file$exdate - option_file$date
#Devide strike by 1000
option_file$strike_price <- option_file$strike_price/1000
#Keep only the observation between 1996 and 2014 in treasury bill
treasury_bill <- subset(treasury_bill, DATE > as.Date("1995-12-29") & DATE < as.Date("2015-01-01") )
#Replace the . with 0 in the treasury_bill dataframe
treasury_bill$DTB3 = as.character(treasury_bill$DTB3)
treasury_bill$DTB3[treasury_bill$DTB3 == "."] <- "NA"
treasury_bill$DTB3 = as.double(treasury_bill$DTB3)
treasury_bill$DTB3 = na_ma(treasury_bill$DTB3, k =1, weighting = "simple")
#Devide interest by 100
treasury_bill$DTB3 <- treasury_bill$DTB3/100
#change the name in the dataframe option_file
names(option_file)[names(option_file) == "strike_price"] <- "strike"
names(option_file)[names(option_file) == "best_bid"] <- "bid"
names(option_file)[names(option_file) == "best_offer"] <- "ask"
names(option_file)[names(option_file) == "impl_volatility"] <- "implied"
names(option_file)[names(option_file) == "strike_price"] <- "strike"
names(option_file)[names(option_file) == "open_interest"] <- "interest"
names(option_file)[names(option_file) == "cp_flag"] <- "cpflag"
#change the name in the dataframe treasury_bill
names(treasury_bill)[names(treasury_bill) == "DATE"] <- "date-rf"
names(treasury_bill)[names(treasury_bill) == "DTB3"] <- "interest"
#change the name in the dataframe index_series
names(index_series)[names(index_series) == "date"] <- "date_cboe"
names(index_series)[names(index_series) == "return"] <- "returns"
option_file$return <- NULL
option_file$volume <- NULL
option_file$interest <- NULL
option_file$implied <- NULL
option_file$delta <- NULL
option_file$gamma <- NULL
option_file$vega <- NULL
option_file$theta <- NULL
write.csv(option_file[200000:205000,], "../data/option.csv", row.names=FALSE)
write.csv(index_series, "../data/index.csv", row.names=FALSE)
write.csv(treasury_bill, "../data/interest.csv", row.names=FALSE)
#clan the workspace
rm(list = ls())
#packages
library(tidyverse)
library(fOptions)
library(ggplot2)
library(roll)
#Loading the excel file
raw_data <- read.csv("../data/rawdata.csv")
raw_data = raw_data %>% mutate(date=as.Date(date))
raw_data = raw_data[order(as.Date(raw_data$date, format = "%Y/%m/%d")),]
raw_data$bid <- NULL
raw_data$ask <- NULL
raw_data$BS5.strike <- NULL
raw_data$BS30.strike <- NULL
raw_data$BS60.strike <- NULL
raw_data$BS90.strike <- NULL
raw_data$BS120.strike <- NULL
raw_data$BSgarch.strike <- NULL
raw_data$lag_close <- NULL
#subset call
call <- subset(raw_data, cpflag == "C")
#1) price option that is traded above 10 basis points
call <- subset(call, mid > 0.1)
#2) keep only the call options which have maturity in 15 days or 2 years (252 is used as the number of trading days in one year)
call['d_maturity'] = call$maturity/252
call <- subset(call, d_maturity > 15/252 & d_maturity < 2)
#3)keep only the call option which are not extremely ITM or OTM therefore we keep only the moneyness between 0.5 and 1.55
call <- subset(call, moneyness > 0.5 & moneyness < 1.55 )
#4)keep only the options that don't violate the lower bound conditon see page 262
call['lb_c'] <- call$close - (call$strike*exp(-call$interest*call$d_maturity))
call <- subset(call, mid >= lb_c)
#subset put
put <- subset(raw_data, cpflag == "P")
#1) price option that is traded above 10 basis points
put <- subset(put, mid > 0.1)
#2) keep only the put options which have maturity in 15 days or 2 years (252 is used as the number of trading days in one year)
put['d_maturity'] = put$maturity/252
put <- subset(put, d_maturity > 15/252 & d_maturity < 2)
#3)keep only the put option which are not extremely ITM or OTM therefore we keep only the moneyness between 0.5 and 1.55
put <- subset(put, moneyness > 0.5 & moneyness < 1.55 )
#4)keep only the options that don't violate the lower bound conditon see page 262
put['lb_p'] <- (put$strike*exp(-put$interest*put$d_maturity)) - put$close
put <- subset(put, mid >= lb_p)
call$lb_c <- NULL
put$lb_p <- NULL
call$d_maturity <- NULL
put$d_maturity <- NULL
pdata <- rbind(call, put)
tot = nrow(call) + nrow(put)
write.csv(pdata, "../data/plot_data.csv")
write.csv(call, "../data/call.csv")
write.csv(put, "../data/put.csv")
#see which are the most common strike for call and put
#call
c_l <- rle(sort(call$strike))
call_strikes <- data.frame(strikes=c_l$values, number=c_l$lengths)
#put
p_l <- rle(sort(put$strike))
put_strikes <- data.frame(strikes=p_l$values, number=p_l$lengths)
